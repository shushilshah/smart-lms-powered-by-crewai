{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>AI Course Generator</title>

    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">

    <div class="card shadow p-4">
        <h3 class="mb-3">AI Course Generator</h3>

        <div class="mb-3">
            <label class="form-label">Course Prescription</label>
            <textarea id="prescription" class="form-control"
                rows="4"
                placeholder="Example: Create a beginner Django course with projects"></textarea>
        </div>

        <button class="btn btn-primary" onclick="generateCourse()">
            Generate Course
        </button>
    </div>

    <div class="card shadow mt-4 p-4 d-none" id="resultCard">
        <h4>Generated Course</h4>
        <div id="resultContent"></div>
    </div>

    <div id="loadingSection" class="text-center mt-4 d-none">
    <div class="spinner-border text-primary" role="status"></div>
    <h5 class="mt-3">AI is designing your course...</h5>
    <p id="loadingStatus" class="text-muted">
        Analyzing your prescription...
    </p>
    </div>


</div>

<script>
async function generateCourse() {

    const prescription = document.getElementById("prescription").value;
    const loadingSection = document.getElementById("loadingSection");
    const loadingStatus = document.getElementById("loadingStatus");
    const resultCard = document.getElementById("resultCard");
    const resultContent = document.getElementById("resultContent");

    if (!prescription) {
        alert("Please enter a course description.");
        return;
    }

    resultCard.classList.add("d-none");
    loadingSection.classList.remove("d-none");

    // Simulate thinking steps
    const messages = [
        "Analyzing your prescription...",
        "Designing course structure...",
        "Defining learning outcomes...",
        "Finalizing curriculum..."
    ];

    let step = 0;
    const interval = setInterval(() => {
        if (step < messages.length) {
            loadingStatus.textContent = messages[step];
            step++;
        }
    }, 1500);

    try {
        const response = await fetch("/ai/generate-course/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": "{{ csrf_token }}"
            },
            body: JSON.stringify({ prescription })
        });

        const data = await response.json();

        clearInterval(interval);
        loadingSection.classList.add("d-none");
        resultCard.classList.remove("d-none");

        if (data.error) {
            resultContent.innerHTML =
                `<div class="alert alert-danger">${data.error}</div>`;
            return;
        }

        resultContent.innerHTML = `
            <div class="alert alert-success">
                ðŸŽ‰ Course Created Successfully!
            </div>

            <h4>${data.title}</h4>
            <p class="text-muted">${data.level.toUpperCase()} â€¢ ${data.duration}</p>

            <p>${data.description}</p>

            <h6>Learning Outcomes</h6>
            <ul>
                ${data.learning_outcomes.split("\n").map(item => `<li>${item}</li>`).join("")}
            </ul>

            <div class="mt-3">
                <a href="/courses/${data.id}/edit/" class="btn btn-outline-primary">
                    Edit Course
                </a>
            </div>
        `;

    } catch (error) {
        clearInterval(interval);
        loadingSection.classList.add("d-none");
        alert("Something went wrong.");
    }
}
</script>


</body>
</html>
